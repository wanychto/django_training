{%extends 'vehicle/base.html'%}
{% block title %}
    {% if object.pk %}
        Редактирование атрибута
    {% else %}
        Создание атрибута
    {% endif %}
{% endblock %}
{% block content %}
    {% if object.pk %}
    <div class="upd-attribute-form">
        <h1 class="atr-upd-form-title">Редактирование атрибута</h1>
        
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <label class="form-label">Название</label>
                <input type="text" class="form-control " name="name" value="{{form.name.value|default_if_none:''}}">
            </div>
            
            <div class="form-group">
                <label class="form-label">Единица измерения</label>
                <input type="text" class="form-control " name="unit" value="{{form.unit.value|default_if_none:''}}">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="{{ form.data_type.id_for_label }}">Тип данных</label>
                        {{form.data_type}}
            </div>
            
            <div class="form-group">
                <label class="form-label">Дата создания</label>
                <div class="read-only-field" >{{ form.instance.created_at }}</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Дата обновления</label>
                <div class="read-only-field" >{{ form.instance.updated_at }}</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Удален</label>
                <div class="read-only-field">
                    {% if form.instance.is_deleted == False %}
                        X
                    {% else %}
                        ✓
                    {%endif%}
                    <input type="hidden" name="is_deleted" value="attribute_is_deleted">
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">Сохранить</button>
        </form>
    </div>
    {% else %}
    <div class="container-fluid mt-5 px-0">
        <div class="attribute-form">
            <h1 class="atr-form-title">Создание атрибута</h1>
            <form method="POST" action="#">
            {% csrf_token %}
                <div class="form-group">
                    <label class="form-label" for="name">Название</label>
                    <input type="text" class="atr-form-control" id="name" name="name" value="{{form.name.value|default_if_none:''}}" placeholder="Например, Диаметр" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="unit">Единица измерения</label>
                    <input type="text" class="atr-form-control" id="unit" name="unit" value="{{form.unit.value|default_if_none:''}}" placeholder="мм, кг, л и т.п." required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="{{ form.data_type.id_for_label }}">Тип данных</label>
                        {{form.data_type}}
                </div>
                
                <button type="submit" class="btn-save">Сохранить</button>
            </form>
        </div>
    </div>
    {% endif %}
{% endblock %}
{% block scripts %}
<script>
    function enableEdit(element) {
        const parent = element.parentElement;
        const displayDiv = parent.querySelector('.form-value');
        const inputField = parent.querySelector('.edit-mode');
        
        displayDiv.style.display = 'none';
        inputField.style.display = 'block';
        inputField.focus();
        
        if (inputField.tagName === 'SELECT') {
            inputField.size = inputField.options.length > 5 ? 5 : inputField.options.length;
        }
    }
    
    function disableEdit(element) {
        const parent = element.parentElement;
        const displayDiv = parent.querySelector('.form-value');
        
        if (element.tagName === 'SELECT') {
            const selectedOption = element.options[element.selectedIndex];
            displayDiv.textContent = selectedOption.text;
            element.size = 0;
        } else {
            displayDiv.textContent = element.value;
        }
        
        element.style.display = 'none';
        displayDiv.style.display = 'block';
    }
    
    function handleKeyPress(event, element) {
        if (event.key === 'Enter') {
            event.preventDefault();
            disableEdit(element);
        }
    }
</script>
{% endblock %}